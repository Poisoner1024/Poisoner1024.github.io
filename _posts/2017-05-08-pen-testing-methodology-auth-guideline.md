---
layout: post
title: "Web应用程序渗透测试方法论 - 测试验证机制"
description: "验证机制是客户端向服务器证明其身份的特殊方法"
tags: [web, security, test]
---
注：原文来自《黑客攻防技术宝典》

* 目录
{:toc}

{% include image.html path="documentation/pen-test/test-auth-mech.png" path-detail="documentation/pen-test/test-auth-mech.png" alt="test-auth-mech" %}

## 1. 了解验证机制
(1) 确定应用程序使用的验证技术（如表单、证书或多元机制）。

(2) 确定所有与验证有关的功能（如登陆、注册、账户恢复等）。

(3) 如果应用程序并未采用自动自我注册机制，确定是否可以使用任何其他方法获得几个用户账户。

## 2. 测试密码强度
(1) 在应用程序中查找有关用户密码最小强度规则的说明。

(2) 尝试使用所有自我注册或密码修改功能，设定各种脆弱密码，确定应用程序实际应用的密码强度规则。尝试使用短密码、仅包含字母字符的密码、全部大写或全部小写字符的密码、单词型密码以及将当前用户名作为密码。

(3) 测试不完整的证书确认。设定一个强大并且复杂的密码（例如，密码长度为12个字符，其中包含大小写字母、数字和印刷字符）。尝试用这个密码的各种变化形式登陆，如删除最后一个字符，改变字符的大小写，或者删除任何特殊字符。如果其中一些尝试取得成功，继续系统性地尝试，了解完整的证书确认过程。

(4) 了解最小密码强度规则以及密码确认的程度后，在设法确定密码猜测攻击所需要使用的密码值范围，以提供攻击成功地可能性。尝试找出所有的内置账户，它们可能并不满足标准密码复杂度要求。

## 3. 测试用户名枚举
(1) 确定各种验证功能通过在屏幕上显示的输入字段、隐藏表单字段或Cookie提交用户名的每一个位置。这些位置通常存在于登陆、自我注册、密码修改、退出与账户恢复功能中。

(2) 向每个位置提交两个请求，其中分别包含一个有效和一个无效的用户名。分析服务器对每一个请求的响应的各方面细节，包括HTTP状态码、任何重定向、屏幕上显示的信息、任何隐藏在HTML页面源代码中的差异以及服务器做出响应的时间。请注意，其中一些差异可能极其细微（例如，看似相同的错误消息可能包含排版方面的细小差异）。可以使用拦截代理服务器的“历史记录”功能分析进出服务器的所有流量。WebScarab的一项功能可对两个响应进行比较，以迅速确定它们之间的任何差异。

(3) 如果从提交有效和无效用户名返回的响应中发现任何差异，那么使用另外一组用户名重复测试，确定响应之间是否存在相同的模式差异，以此作为自动化用户名枚举的基础。

(4) 检查应用程序中任何其他可帮助获得一组有效用户名的信息泄露源，例如，日志功能、注册用户列表以及在源代码注释中直接提及姓名或电子邮件地址的情况。

(5) 定位任何接受用户名的附属验证机制，并确定是否可以将其用于用户名枚举。特别注意允许指定用户名的注册页面。

## 4. 测试密码猜测的适应性
(1) 确定应用程序提交用户证书的每一个位置。通常，用户主要在主登陆功能和密码修改功能中提交证书。如果用户可提交任意用户名，密码修改功能才会成为密码猜测攻击的有效目标。

(2) 在每一个位置，使用一个受控制的账户手动提出几个包含有效用户名但证书无效的请求。监控应用程序的响应，确定他们之间的所有差异。如果应用程序经过大约10次登陆失败后还没有返回任何有关账户锁定的消息，再提交一个包含有效证书的骑牛。如果这个请求登陆成功，应用程序可能并未采用任何账户锁定策略。

(3) 如果没有控制任何账户，那么尝试枚举或猜测一个有效地用户名，并使用它提交几个无效的请求，监控任何有关账户锁定的错误消息。当然，应该意识到，这种测试可能会导致其他用户的账户被冻结或禁止。

## 5. 测试账户恢复功能
(1) 确定如果用户忘记他们的证书，应用程序是否允许他们重新控制自己的账户。通常，在主登陆功能附近有一个“忘记密码”链接即表示应用程序采用了密码恢复功能。

(2) 使用一个受控制的账户完成整个密码恢复过程，了解账户恢复功能的运作机制。

(3) 如果该功能使用机密问题之类的质询，确定用户是否可以在注册时设定或选择他们自己的质询。如果可以，使用一组枚举出的或常见的用户名获取一组质询，并对其进行分析，找出任何很容易猜测出答案的质询。

(4) 如果该功能使用密码“暗示”，采取和上个步骤相同的操作获取一组密码暗示，确定任何可轻易猜测出答案的暗示。

(5) 对账户恢复质询进行与主登陆功能相同的测试，确定可对其实施自动猜测攻击的漏洞。

(6) 如果该功能要求向用户发送一封电子邮件才能完成整个恢复过程，寻找任何可帮助控制其他用户账号的弱点。确定是否有可能控制接受以上电子邮件的地址。如果邮件内容中包含一个唯一的恢复URL，使用受控制的一个电子邮件地址获得若干邮件，尝试确定任何可帮助预测发布给其他用户的URL模式。

## 6. 测试“记住我”功能
(1) 如果主登陆功能或它的支持逻辑包含“记住我”功能，激活这项功能并分析它的作用。如果该功能允许用户随后不输入任何证书即可登陆，那么应该仔细分析这项功能，查找其中存在的所有漏洞。

(2) 仔细检查激活“记住我”功能时设定的所有持久性Cookie。寻找任何明确标识出用户身份或明显包含可预测的用户标识符的数据。

(3) 即使其中保存的数据经过严密编码或模糊处理，也要仔细分析这些数据，并比较“记住”几个非常类似的用户名和密码的结果，找到任何可对原始数据进行逆向功能的机会。

(4) 根据以上结果，适当修改Cookie的内容，尝试伪装成其他应用程序用户。

## 7. 测试伪装功能

## 8. 测试用户名的唯一性

## 9. 测试证书的可预测性

## 10. 检测不安全的证书传输

## 11. 检测不安全的证书分配## 

## 12. 检测不安全的存储

## 13. 测试逻辑缺陷
### 13.1 故障开放条件
### 13.2 测试多阶段处理机制

## 14. 利用漏洞获取未授权访问
















